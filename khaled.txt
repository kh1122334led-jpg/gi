<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <title>Student Tasks App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:Arial;padding:20px;background:#eef2f5;}
    .wrap{max-width:700px;margin:auto;background:white;padding:20px;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,0.08);}
    h2{margin:0 0 10px;}
    input,button{padding:10px;font-size:15px;border-radius:6px;border:1px solid #ccc;margin:6px 0;}
    button{background:#2563eb;color:#fff;border:none;cursor:pointer}
    .row{display:flex;gap:10px}
    .row input{flex:1}
    .task{display:flex;justify-content:space-between;background:#f8fbff;border:1px solid #ddd;margin:6px 0;padding:10px;border-radius:6px;}
    .done{text-decoration:line-through;color:#777}
    .small{font-size:13px;color:#666}
    .btn{padding:5px 8px;font-size:13px;border-radius:5px;border:none;color:#fff;cursor:pointer}
    .del{background:#ef4444}
    .ok{background:#10b981}
  </style>
</head>
<body>

<div class="wrap">
  <h2>Student To-Do App</h2>

  <input id="khaled" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />

  <div class="row">
    <input id="task" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ù…Ø©">
    <input type="date" id="date">
    <button id="add">Add</button>
  </div>

  <div class="small">ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¹Ù„Ù‰ Firestore Ù„Ø­Ø¸ÙŠØ§Ù‹</div>

  <div id="list"></div>
</div>

<script type="module">

  // Firebase CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore, collection, addDoc, onSnapshot,
    doc, updateDoc, deleteDoc, orderBy, query
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ğŸ”§
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const todos = collection(db, "tasks_app");

  const student = document.getElementById("student");
  const task = document.getElementById("task");
  const date = document.getElementById("date");
  const addBtn = document.getElementById("add");
  const list = document.getElementById("list");

  addBtn.onclick = async () => {
    if (!task.value.trim()) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ù…Ø©");

    await addDoc(todos, {
      student: student.value.trim() || "â€”",
      text: task.value.trim(),
      due: date.value || null,
      done: false,
      created: Date.now()
    });

    task.value = "";
    date.value = "";
  };

  const q = query(todos, orderBy("created", "desc"));
  onSnapshot(q, snapshot => {
    list.innerHTML = "";
    if (snapshot.empty) return list.innerHTML = "<div class='small'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¨Ø¹Ø¯</div>";

    snapshot.forEach(docSnap => {
      const d = docSnap.data();
      const id = docSnap.id;

      const div = document.createElement("div");
      div.className = "task";

      div.innerHTML = `
        <div>
          <div class="${d.done ? 'done' : ''}">${escape(d.text)}</div>
          <div class="small">Ø§Ù„Ø·Ø§Ù„Ø¨: ${escape(d.student)} â€¢ ${d.due || "Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ¹Ø¯"}</div>
        </div>

        <div>
          <button class="btn ok" data-t="toggle">${d.done ? "Undo" : "Done"}</button>
          <button class="btn del" data-t="delete">Delete</button>
        </div>
      `;

      div.querySelector("[data-t='toggle']").onclick = () => {
        updateDoc(doc(db, "tasks_app", id), { done: !d.done });
      };

      div.querySelector("[data-t='delete']").onclick = () => {
        if (confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ"))
          deleteDoc(doc(db, "tasks_app", id));
      };

      list.appendChild(div);
    });
  });

  function escape(str){
    return String(str).replace(/[<>&'"]/g, s => ({
      "<":"&lt;", ">":"&gt;", "&":"&amp;", "'":"&#39;", '"':"&quot;"
    }[s]));
Â Â }

</script>